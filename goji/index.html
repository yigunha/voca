<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>원고지 - 학생</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- 설정 영역 -->
        <div class="setup-area">
            <label for="classSelect">반:</label>
            <select id="classSelect">
                <option value="3A">3A</option>
                <option value="3B">3B</option>
                <option value="4A">4A</option>
                <option value="4B">4B</option>
            </select>
            
            <label for="studentName">학생 이름:</label>
            <input type="text" id="studentName" placeholder="이름을 입력하세요">
            
            <label for="studentPassword">비밀번호:</label>
            <input type="password" id="studentPassword" placeholder="비밀번호 4자리">
            
            <label for="colsSelect">칸 수:</label>
            <select id="colsSelect">
                <option value="20">20칸 (400자)</option>
                <option value="25-300">25칸 (300자)</option>
                <option value="25-700">25칸 (700자)</option>
            </select>
            
            <button id="startBtn">시작</button>
        </div>
        
        <!-- 안내 정보 -->
        <div class="info" id="infoArea">
            원고지 작성 규칙<br>
            대기 시스템: 숫자, 마침표/쉼표, 영어소문자는 다음 글자를 기다림<br>
            화살표 키로 칸 이동, 백스페이스로 삭제
        </div>
        
        <!-- 작업 영역 -->
        <div id="workArea" class="work-area">
            <!-- 원고지 래퍼 -->
            <div class="manuscript-wrapper">
                <div class="error-line-container">
                    <svg id="errorLineSvg" class="error-line-svg"></svg>
                </div>
                <div id="manuscriptPaper" class="manuscript-paper cols-20"></div>
            </div>
            
            <!-- 글자 수 -->
            <div class="char-count">글자 수: <span id="charCount">0</span></div>
            
            <!-- 액션 버튼 -->
            <div class="action-buttons">
                <button class="supabase-save-btn" onclick="saveToSupabase()">서버에 저장</button>
                <button class="supabase-load-btn" onclick="loadFromSupabase()">서버에서 불러오기</button>
                <button class="copy-btn" onclick="copyToClipboard()">텍스트 복사</button>
                <button class="logout-btn" onclick="logout()">로그아웃</button>
            </div>
            
            <!-- 입력창 -->
            <div class="input-box">
                <input type="checkbox" id="teacherToggle" class="teacher-toggle" disabled>
                <span id="prevContent" class="prev-content"></span>
                <input type="text" id="inputBox" placeholder="">
            </div>
        </div>
    </div>
    
    <!-- 저장 모달 -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <h2>원고 저장</h2>
            <input type="text" id="saveTitle" placeholder="제목을 입력하세요 (예: 첫번째 작문)">
            <div class="btn-group">
                <button class="confirm-btn" onclick="confirmSave()">저장</button>
                <button class="cancel-btn" onclick="closeSaveModal()">취소</button>
            </div>
        </div>
    </div>
    
    <!-- 불러오기 모달 -->
    <div id="loadModal" class="modal">
        <div class="modal-content">
            <h2>저장된 원고 목록</h2>
            <ul id="savedList" class="saved-list"></ul>
            <div class="btn-group">
                <button class="cancel-btn" onclick="closeLoadModal()">닫기</button>
            </div>
        </div>
    </div>
    
    <!-- WASM 및 스크립트 로드 -->
    <script type="module">
        // WASM 빌드 확인 및 로드
        async function loadApp() {
            try {
                // wongo-bridge.js 로드
                const { initWongoApp } = await import('./wongo-bridge.js');
                window.initWongoApp = initWongoApp;
                
                // student-app.js 로드
                await import('./student-app.js');
            } catch (error) {
                console.error('로딩 실패:', error);
                document.body.innerHTML = `
                    <div style="padding: 50px; text-align: center; color: white;">
                        <h1>⚠️ WASM 모듈이 빌드되지 않았습니다</h1>
                        <p style="margin: 20px 0;">다음 명령어를 실행해주세요:</p>
                        <pre style="background: #000; padding: 20px; border-radius: 5px; display: inline-block; text-align: left;">
wasm-pack build --target web --out-dir www/pkg --release
                        </pre>
                        <p style="margin-top: 20px; color: #888;">
                            빌드 후 페이지를 새로고침하세요.
                        </p>
                    </div>
                `;
            }
        }
        
        loadApp();
    </script>
</body>
</html>